<project name="Linux printing support" default="dist" basedir=".">
    <description>
        Linux printing support backported from OpenJDK 1.7, to workaround
    	problems with Java 1.5 and modern versions of CUPS printing system.
    	This project will not be necessary when we move gvSIG to Java 1.6 or 1.7.
    </description>
  <!-- set global properties for this build -->
  <property name="src" location="src"/>
  <property name="src-test" location="src-test-ui"/>
  <property name="build" location="bin"/>
  <property name="build-test" location="bin-test"/>
  <property name="dist"  location="dist"/>
  <property name="lib"  location="lib"/>
  <property name="jarName" value="org.gvsig.printing.cups-support"/>
  <property name="gvSIGLibs" location="../appgvSIG/lib"/>
  <property name="targetDir" location="${gvSIGLibs}"/>

	<import file="../binaries/ant/utilities.xml"/>

  <target name="init">
    <!-- Create the time stamp -->
  	<tstamp/>
    <!-- Create the build directory structure used by compile -->
	<echo>
		Compiling ${ant.project.name}...</echo>
  </target>

  <target name="dist" depends="init,create-jar,move-to-installDir" />

  <target name="clean"
        description="clean up" >
    <!-- Delete the ${build} and ${dist} directory trees -->
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>


	<target name="batch-build"
			description="compile the sources, create the jar file"
			depends="compile,create-jar,move-to-installDir">
	</target>

	<target name="compile" description="compile the source">
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${build}"/>
		<!-- Compile the Java code from ${src} to ${build} -->
		<loadEclipseClasspath project="${basedir}"/>
		<gvSIG-javac
			classpath="${eclipseClasspath}"
		/>
		<copy todir="${build}">
			<fileset dir="${src}" excludes="**/*.java,**/CVS"></fileset>
		</copy>
	</target>

	<target name="create-jar" description="Creates the jar file">
		<mkdir dir="${dist}"/>
		<jar jarfile="${dist}/${jarName}.jar" basedir="${build}">
    		<manifest>
    			<section name="common">
		    		<attribute name="Built-By" value="${user.name}"/>
		    		<attribute name="Implementation-Title" value="$gvSIG Beans" />
	    			<attribute name="Implementation-Version" value="${TODAY}" />
	    			<attribute name="Implementation-Vendor" value="the gvSIG project" />
	    		</section>
    			<!-- finally, use the magically generated libs path -->
    		</manifest>
		</jar>
		<!-- show in the jar name the date on which the sources were updated -->
		<jar jarfile="${dist}/${jarName}.jar" basedir="." includes="images/*" update="true" />
	</target>

	<target name="move-to-installDir" description="Moves the build directory to andami">
		<move todir="${targetDir}">
			<fileset dir="${dist}" includes="**/*" />
		</move>
	</target>

	<target name="run-tests" depends="batch-build,compile-tests">
		<antcall target="generic-run-tests">
			<param name="TestSuite.Name" value="org.gvsig.gui.beans.AllTests"/>
		</antcall>
	</target>

</project>

